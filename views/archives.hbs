<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="/wordle/favicon.svg">
	<title>42 Wordle - Archives</title>
	<link rel="stylesheet" href="/archives/archives.css">
</head>
<body>
	<div class="archives-layout">
		<!-- === SIDEBAR === -->
		<div class="sidebar">
			<div class="sidebar-header">
				<h2>ğŸ“š Archives</h2>
				<div class="navigation-buttons">
					<a href="/" class="nav-btn home-btn">ğŸ </a>
					<a href="/wordle" class="nav-btn play-btn">ğŸ®</a>
				</div>
			</div>

			<!-- Section des dates disponibles (collapsible) -->
			<div class="collapsible-section dates-section">
				<div class="section-header" onclick="toggleSection('dates')">
					<h3>ğŸ“… Dates disponibles</h3>
					<span class="toggle-arrow" id="dates-arrow">â–¼</span>
				</div>
				<div class="section-content" id="dates-content">
					{{#if availableDates.length}}
						<div class="dates-container">
							{{#each availableDates}}
								<a href="/archives?date={{date}}"
								   class="date-item {{#if (eq date ../selectedDate)}}active{{/if}}"
								   data-date="{{date}}">
									<div class="date-display">{{displayDate}}</div>
									<div class="date-short">{{formattedDate}}</div>
								</a>
							{{/each}}
						</div>
					{{else}}
						<div class="no-dates">
							<p>Aucune archive disponible</p>
							<a href="/wordle" class="play-now-btn">Jouer maintenant</a>
						</div>
					{{/if}}
				</div>
			</div>

			<!-- Section des top streaks (collapsible) -->
			<div class="collapsible-section streaks-section">
				<div class="section-header" onclick="toggleSection('streaks')">
					<h3>ğŸ”¥ Top Streaks</h3>
					<span class="toggle-arrow" id="streaks-arrow">â–¼</span>
				</div>
				<div class="section-content" id="streaks-content">
					{{#if topStreaks.length}}
						{{#each topStreaks}}
							<div class="player-row-streaks">
								<span class="rank">{{inc @index 1}}</span>
								<span class="player-name">{{login}}</span>
								<span class="score">ğŸ”¥ {{bestStreak}} jour{{#if (gt bestStreak 1)}}s{{/if}}</span>
							</div>
						{{/each}}
					{{else}}
						<div class="no-data">Aucune donnÃ©e</div>
					{{/if}}
				</div>
			</div>
		</div>

		<!-- === CONTENU PRINCIPAL === -->
		<div class="main-content">
			{{#if error}}
				<!-- Gestion des erreurs -->
				<div class="error-message">
					<h2>âŒ Erreur</h2>
					<p>{{error}}</p>
				</div>

			{{else if selectedArchive}}
				<!-- En-tÃªte de l'archive sÃ©lectionnÃ©e -->
				<div class="archive-header">
					<div class="archive-title">
						<h1>ğŸ“… {{selectedArchive.displayDate}}</h1>
						<div class="word-reveal">
							<span class="word-label">Mot du jour :</span>
							<span class="word-of-day">{{selectedArchive.wordOfTheDay}}</span>
						</div>

						<!-- Statistiques dÃ©taillÃ©es -->
						{{#if selectedArchive.stats.successCount}}
							<div class="detailed-stats">
								<div class="stat-row">
									<div class="stat-item success">
										<span class="stat-icon">âœ…</span>
										<span class="stat-number">{{selectedArchive.stats.successCount}}</span>
										<span class="stat-desc">RÃ©ussites</span>
									</div>
									<div class="stat-item failure">
										<span class="stat-icon">âŒ</span>
										<span class="stat-number">{{selectedArchive.stats.failureCount}}</span>
										<span class="stat-desc">Ã‰checs</span>
									</div>
									{{#if (gt selectedArchive.stats.successCount 0)}}
										<div class="stat-item average">
											<span class="stat-icon">â±ï¸</span>
											<span class="stat-number">{{selectedArchive.stats.averageTime}}s</span>
											<span class="stat-desc">Temps moyen</span>
										</div>
										<div class="stat-item average">
											<span class="stat-icon">ğŸ¯</span>
											<span class="stat-number">{{selectedArchive.stats.averageAttempts}}</span>
											<span class="stat-desc">Essais moyens</span>
										</div>
									{{/if}}
								</div>
							</div>
						{{/if}}
					</div>

					<!-- Carte du nombre total de joueurs -->
					<div class="archive-stats">
						<div class="stat-card">
							<span class="stat-value">{{selectedArchive.totalPlayers}}</span>
							<span class="stat-label">Joueur{{#if (gt selectedArchive.totalPlayers 1)}}s{{/if}}</span>
						</div>
					</div>
				</div>

				<div class="content-grid">
					<!-- === LEADERBOARDS AVEC SCROLL === -->
					<div class="leaderboards-section">
						<!-- Classement par temps -->
						<div class="leaderboard fastest">
							<h3>âš¡ Classement par temps ({{selectedArchive.stats.fastest.length}})</h3>
							<div class="leaderboard-scroll-container">
								<div class="leaderboard-content">
									{{#if selectedArchive.stats.fastest.length}}
										{{#each selectedArchive.stats.fastest}}
											<div class="player-row {{#if (eq attempts 7)}}failed{{/if}}" data-rank="{{inc @index 1}}">
												<span class="rank">{{inc @index 1}}</span>
												<span class="player-name">{{login}}</span>
												{{#if (eq attempts 7)}}
													<span class="score failed">âŒ Ã‰chec ({{time}}s)</span>
												{{else}}
													<span class="score">â±ï¸ {{time}}s ({{attempts}} essai{{#if (gt attempts 1)}}s{{/if}})</span>
												{{/if}}
											</div>
										{{/each}}
									{{else}}
										<div class="no-data">Aucune donnÃ©e</div>
									{{/if}}
								</div>
							</div>
						</div>

						<!-- Classement par nombre d'essais -->
						<div class="leaderboard fewest">
							<h3>ğŸ¯ Classement par essais ({{selectedArchive.stats.fewest_attempts.length}})</h3>
							<div class="leaderboard-scroll-container">
								<div class="leaderboard-content">
									{{#if selectedArchive.stats.fewest_attempts.length}}
										{{#each selectedArchive.stats.fewest_attempts}}
											<div class="player-row {{#if (eq attempts 7)}}failed{{/if}}" data-rank="{{inc @index 1}}">
												<span class="rank">{{inc @index 1}}</span>
												<span class="player-name">{{login}}</span>
												{{#if (eq attempts 7)}}
													<span class="score failed">âŒ Ã‰chec ({{time}}s)</span>
												{{else}}
													<span class="score">ğŸ¯ {{attempts}} essai{{#if (gt attempts 1)}}s{{/if}} ({{time}}s)</span>
												{{/if}}
											</div>
										{{/each}}
									{{else}}
										<div class="no-data">Aucune donnÃ©e</div>
									{{/if}}
								</div>
							</div>
						</div>
					</div>

					<!-- === GRILLE DE TOUS LES PARTICIPANTS === -->
					<div class="all-players-section">
						<h3>ğŸ‘¥ Tous les participants par ordre chronologique ({{selectedArchive.totalPlayers}})</h3>
						<div class="players-grid">
							{{#each selectedArchive.stats.allPlayers}}
								<div class="player-card {{#if (eq attempts 7)}}failed{{/if}}">
									<div class="player-info">
										<div class="player-name">{{login}}</div>
										{{#if (eq attempts 7)}}
											<div class="player-result failed">âŒ Ã‰chec aprÃ¨s 6 essais</div>
											<div class="player-time">â±ï¸ {{time}}s</div>
										{{else}}
											<div class="player-stats">
												<span class="attempts">ğŸ¯ {{attempts}} essai{{#if (gt attempts 1)}}s{{/if}}</span>
												<span class="time">â±ï¸ {{time}}s</span>
											</div>
										{{/if}}
									</div>
								</div>
							{{/each}}
						</div>
					</div>
				</div>

			{{else}}
				<!-- Ã‰tat par dÃ©faut : aucune archive sÃ©lectionnÃ©e -->
				<div class="no-archive-selected">
					<div class="placeholder-content">
						<h2>ğŸ“‹ SÃ©lectionnez une date</h2>
						<p>Choisissez une date dans la sidebar pour voir les archives des parties prÃ©cÃ©dentes</p>
						{{#if availableDates.length}}
							<button onclick="selectFirstDate()" class="select-date-btn">
								Voir la plus rÃ©cente
							</button>
						{{/if}}
					</div>
				</div>
			{{/if}}
		</div>
	</div>

	<!-- === BOUTON MOBILE === -->
	<button class="mobile-toggle" onclick="toggleSidebar()">
		<span class="toggle-icon">â˜°</span>
	</button>

	<!-- === SCRIPTS === -->
	<script>
		// Ã‰tat des sections (true = ouvert, false = fermÃ©)
		const sectionStates = {
			dates: true,    // Ouvert par dÃ©faut
			streaks: false  // FermÃ© par dÃ©faut sur mobile
		};

		// Initialisation au chargement de la page
		document.addEventListener('DOMContentLoaded', function() {
			// DÃ©finir l'Ã©tat initial basÃ© sur la taille d'Ã©cran
			if (window.innerWidth <= 768) {
				sectionStates.dates = true;
				sectionStates.streaks = false;
			} else {
				sectionStates.dates = true;
				sectionStates.streaks = true;
			}

			// Appliquer les Ã©tats initiaux
			updateSectionState('dates', sectionStates.dates);
			updateSectionState('streaks', sectionStates.streaks);

			// Animation progressive des Ã©lÃ©ments de leaderboard
			const playerRows = document.querySelectorAll('.player-row');
			playerRows.forEach((row, index) => {
				row.style.animationDelay = `${0.1 + (index * 0.05)}s`;
			});
		});

		// Gestion du redimensionnement de la fenÃªtre
		window.addEventListener('resize', function() {
			if (window.innerWidth > 768) {
				// Sur desktop, ouvrir les deux sections si elles sont fermÃ©es
				if (!sectionStates.dates) toggleSection('dates');
				if (!sectionStates.streaks) toggleSection('streaks');
			}
		});

		// Toggle d'une section spÃ©cifique
		function toggleSection(sectionName) {
			sectionStates[sectionName] = !sectionStates[sectionName];
			updateSectionState(sectionName, sectionStates[sectionName]);
		}

		// Mise Ã  jour de l'Ã©tat visuel d'une section
		function updateSectionState(sectionName, isOpen) {
			const content = document.getElementById(sectionName + '-content');
			const arrow = document.getElementById(sectionName + '-arrow');

			if (isOpen) {
				content.classList.add('open');
				arrow.style.transform = 'rotate(180deg)';
			} else {
				content.classList.remove('open');
				arrow.style.transform = 'rotate(0deg)';
			}
		}

		// Gestion de l'ouverture/fermeture de la sidebar mobile
		function toggleSidebar() {
			const sidebar = document.querySelector('.sidebar');
			sidebar.classList.toggle('open');
		}

		// SÃ©lection automatique de la premiÃ¨re date
		function selectFirstDate() {
			const firstDateLink = document.querySelector('.date-item');
			if (firstDateLink) {
				window.location.href = firstDateLink.href;
			}
		}

		// Fermeture automatique de la sidebar sur mobile aprÃ¨s sÃ©lection
		document.querySelectorAll('.date-item').forEach(item => {
			item.addEventListener('click', () => {
				if (window.innerWidth <= 768) {
					setTimeout(() => {
						document.querySelector('.sidebar').classList.remove('open');
					}, 100);
				}
			});
		});

		// Fermeture de la sidebar en cliquant Ã  l'extÃ©rieur sur mobile
		document.addEventListener('click', (e) => {
			if (window.innerWidth <= 768) {
				const sidebar = document.querySelector('.sidebar');
				const toggle = document.querySelector('.mobile-toggle');

				if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
					sidebar.classList.remove('open');
				}
			}
		});
	</script>
</body>
</html>
